(()=>{"use strict";function t(t,e,s,o){Object.defineProperty(t,e,{value:s,enumerable:o,writable:!0,configurable:!0})}const e=Array.prototype,s=Object.create(e);["pop","push","shift","unshift","splice","reverse","sort"].forEach((o=>{const r=e[o];t(s,o,(function(){var t=this.__ob__,e=[...arguments];const s=r.apply(this,e);let n=[];switch(o){case"push":case"unshift":n=e;break;case"splice":n=e.slice(2)}return n&&t.observeArray(n),t.dep.notify(),s}),!1)}));let o=0;class r{constructor(){this.subs=[],this.is=o++}notify(){console.log(this.subs);for(var t=this.subs.slice(),e=0;e<t.length;e++)t[e].update()}addSub(t){this.subs.push(t)}depend(){r.target&&this.addSub(r.target)}}function n(t,e,s){var o=new r;2===arguments.length&&(s=t[e]);let n=l(s);Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:()=>(console.log("对象属性被访问",e),r.target&&(o.depend(),n&&n.dep.depend()),s),set(t){s!==t&&(console.log("对象属性被改写"),n=l(s=t),o.notify())}})}class i{constructor(e){this.dep=new r,t(e,"__ob__",this,!0),Array.isArray(e)?(Object.setPrototypeOf(e,s),this.observeArray(e)):this.walk(e)}walk(t){for(let e in t)"__ob__"!==e&&(console.log(e),n(t,e))}observeArray(t){for(let e=0;e<t.length;e++)l(t[e])}}function l(t){if("object"==typeof t)return void 0!==t.__ob__?t.__ob__:new i(t)}let a=0;console.log(10);var c={a:{m:{n:10}},b:{e:11},c:[11,2,22,33,4,44]};l(c),new class{constructor(t,e,s){var o;console.log("这是一个依赖"),this.id=a++,this.target=t,this.getter=(o=e.split("."),console.log(o),function(t){return o.reduce(((t,e)=>{if(t)return t[e]}),t)}),this.callback=s,this.value=this.get()}update(){this.run()}run(){this.getAndInvoke(this.callback)}getAndInvoke(t){let e=this.get();if(e!==this.value||"object"==typeof e){const s=this.value;this.value=e,t.call(this.target,e,s)}}get(){r.target=this;const t=this.target;let e;try{e=this.getter(t)}finally{r.target=null}return e}}(c,"a.m.n",(()=>{console.log("★★★★★")})),c.a.m=12})();